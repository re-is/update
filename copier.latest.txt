Shl update - Latest version: 190210

Shl update - Alert text: Új verzió érhető el.\n\nMost frissíted?<END-OF-ALERTTEXT>

Shl update - HTA:

<START-TEXT>
<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=11">
		<script type="text/javascript" src="https://rawgit.com/re-is/shl/master/shl.181214.index.js"></script>
		<script type="text/javascript">try{'HTA'.shlInfo()}catch(e){alert("Nincs internet!\n\nPróbáld később.");window.close()}</script>
		<style type="text/css">

			body * {
				font-family: "Calibri Light";
				font-size: 18px;
				color: #333;
			}

			#body {
				position: absolute;
				overflow: hidden;
				top: 0;
				left: 0;
				bottom: 0;
				right: 0;
				background: linear-gradient(to right, #f5f5f5, #fff);
				border: 1px solid #aaa;
			}

				#margin-page {
					position: absolute;
					top: 20px;
					left: 20px;
					bottom: 20px;
					right: 20px;
				}

					span {
						font-family: "Arial";
						letter-spacing: 0.5px;
						font-size: 16px;
						color: #e62;
						font-weight: bold;
					}

					#info {
						margin: 10px 0;
					}

					#button {
						display: none;
						font-family: "Tahoma";
						padding: 3px 20px;
						text-shadow: none;
						letter-spacing: 1px;
						color: #fff;
						background-color: #999;
						transition: 0.2s;
					}

						#button:hover {
							background-color: #777;
							cursor: pointer;
						}

					#code-center {
						position: absolute;
						width: 100%;
						bottom: 10px;
					}

					#code-input {
						width: 300px;
						border: 1px solid #aaa;
						text-align: center;
						display: none;
					}

			#close {
				position: absolute;
				display: inline-block;
				top: -6px;
				right: 8px;
				font-size: 30px;
				padding: 0 10px;
				z-index: 100;
			}

				#close:hover {
					background-color: #d32;
					color: #fff;
					cursor: pointer;
				}

		</style>
	</head>
	<body>
		<div id="body">
			<div id="margin-page">
				ESET <span id="new-eset-version"></span> Kódmásoló, 2019.02.10<br>
				Készítette: Reich István, 2017<br><br>
				<center id="info">Indítás után <span>ne nyúlj a géphez</span>, amíg nem végez !</center>
				<center><div id="button" onclick="start_autoit()">Indítás</div></center>
				<center id="code-center"><input type="text" id="code-input"></center>
			</div>
		</div>
		<div id="close" onclick="'WND'.shlCmd('close')">×</div>
		<script type="text/javascript">

			// Megnyitás:
			'WND'.shlOpen({
				icon		: 'eset32.ico',
				title		: 'ESET Kódmásoló',
				type		: 'tool',
				caption	: false,
				width		: '420px',
				height	: '190px',
				lang		: 'HU',
				fadein	: [300, 100]
			});

			// Frissítés:
			'HTA'.shlSetUpdate({
				'restart-hta': true,
				'current-ver': 190210,
				'update-link': "https://re-is.github.io/update/copier.latest.txt",
				'msgbox-text': "Új verzió érhető el.\n\nMost frissíted?"
			});

			// Globális változók:
			window.g = {
				wscript : 'HTA'.shlActiveX('wss'),
				pressed : false,
				dirname : 'HTA'.shlPathName('folder'),
				regpath : 'HKCR\\DesktopBackground\\Shell\\eset_license\\',
				newEset : '12.0.31.0'
			};

			// Az ablak betöltésekor:
			'WND'.shlOnLoad(function() {
				// Verzió beírása:
				'id'.shlElem('new-eset-version').innerHTML = g.newEset;

				var old_version = 0, current_version = 'HTA'.shlGetUpdate('current-ver');

				// Jelenlegi verzió lekérése, ha lehet:
				try { old_version = parseInt(g.wscript.RegRead(g.regpath + 'Version')) }catch(e){}

				// Új verzió integrálása a context menübe:
				if (current_version > old_version) {
					g.wscript.RegWrite(g.regpath, 'ESET Kódmásoló', 'REG_SZ');
					g.wscript.RegWrite(g.regpath + 'Version', current_version, 'REG_SZ');
					g.wscript.RegWrite(g.regpath + 'Position', 'middle', 'REG_SZ');
					g.wscript.RegWrite(g.regpath + 'Icon', '"' + g.dirname + 'eset24.ico"', 'REG_SZ');
					g.wscript.RegWrite(g.regpath + 'command\\', 'mshta.exe "' + 'HTA'.shlPathName('full') + '"', 'REG_SZ');
				}

				// Kód lekérése és beírása az input-ba:
				'HTA'.shlReadWebTextFile('https://raw.githubusercontent.com/re-is/eset/master/serial-code.txt', function(text) {
					'id'.shlElem('code-input').value = text;
					'id'.shlElem('button').style.display = 'inline-block';
				});

				// Gomb lenyomáskor és kattintáskor megjelenik a kód:
				window.onkeydown = function() { g.pressed = true }
				window.onkeyup = function() { g.pressed = false }
				window.onclick = function() {
					if (!g.pressed) return;
					'id'.shlElem('button').style.display = 'none';
					'id'.shlElem('code-input').style.display = 'inline-block';
				}
			});

			// Indítás:
			function start_autoit() {
				var esetVer = g.wscript.RegRead('HKLM\\SOFTWARE\\ESET\\ESET Security\\CurrentVersion\\Info\\ProductVersion'), copy_state = '';
				// Verzió ellenőrzés:
				if (esetVer != g.newEset) {
					'id'.shlElem('margin-page').style.display = 'none';
					'WND'.shlSetSize(650, 350);
					'MSG'.shlOk("Még nincs telepítve a legújabb ESET vírus��rtó!\n\nÚj verzió: " + g.newEset + "\nJelenlegi: " + esetVer + "\n\nA telepítéshez nyitsd meg az ESET ablakot,\nbal oldali listában a 'Frissítés',\nmajd a jobb-alsó sarokban, 'Frissítések keresése'.\n\nHa kész, akkor 'Védelem állapota' és középen, 'Számítógép újraindítása'.", function() { 'WND'.shlCmd('close') }, "Bezárás");
					return;
				}
				'id'.shlElem('info').innerHTML = 'Másoló szkript indítása...';
				'id'.shlElem('button').style.display = 'none';
				'id'.shlElem('code-input').style.display = 'inline-block';
				g.wscript.Run('"' + g.dirname + 'script.exe"');
				'WND'.shlOnFrame(function(frame) {
					if (frame % 30 != 0) return;
					try {
						copy_state = g.wscript.RegRead('HKCU\\Software\\IsRe Setups\\ESET Copier - State');
						g.wscript.RegDelete('HKCU\\Software\\IsRe Setups\\ESET Copier - State');
					} catch(e) {}

					// Kód elrejtés:
					if (copy_state.shlContains('Started') && ('id'.shlElem('code-input').style.display != 'none')) 'id'.shlElem('code-input').style.display = 'none';
					// Info beírása:
					if (copy_state.shlContains(/Successful|Error/) && !'id'.shlElem('info').innerHTML.shlContains('Kész')) {
						setTimeout(function() { 'WND'.shlCmd('close') }, 4000);
						'id'.shlElem('info').innerHTML = ((copy_state == 'Successful') ? 'Kész a másolás!' : 'Érvénytelen a kód! Szóljatok, hogy frissítsem! :-D');
					}
				});
			}

		</script>
	</body>
</html>
<END-TEXT>
